@model StudentSuplier.Models.AddProductsViewModel

@{
    ViewData["Title"] = "إضافة منتجات";
    ViewData["UserName"] = ViewBag.username;
    Layout = "~/Views/Shared/_LibraryLayout.cshtml";
    string Category = "xyz";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<style>
h4 {
    text-align: center;
    color: #004080;
    margin-bottom: 30px;
    font-weight: bold;
    font-size: 26px;
}

form {
    background-color: #ffffff;
    padding: 35px;
    max-width: 650px;
    margin: 0 auto;
    border: solid #004080;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
    direction: rtl;
}

.form-group {
    margin-bottom: 20px;
}

label {
    font-weight: 600;
    color: #004080;
    display: block;
    margin-bottom: 5px;
}

input.form-control, select.form-control, textarea.form-control {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    font-size: 15px;
    transition: border-color 0.3s;
}

input.form-control:focus, select.form-control:focus, textarea.form-control:focus {
        border-color: #f59e0b;
        box-shadow: 0 0 6px rgba(245, 158, 11, 0.3);
        outline: none;
}

.text-danger {
    font-size: 13px;
    color: #e63946;
    margin-top: 5px;
    display: block;
}

button.btn-primary {
    background-color: #007bff;
    border: none;
    padding: 10px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    display: block;
    margin: 0 auto;
    transition: background-color 0.3s;
}

button.btn-primary:hover {
    background-color: #0056b3;
}


.right-image-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    padding: 20px;
}

.img-fluid {
    width: 600px;
    height: 600px;
    object-fit: cover;
    border-radius: 20px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    display: block;
}

.img-preview {
    width: 300px;
    height: 300px;
    object-fit: cover;
    border-radius: 20px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    display: none;
}

.upload-label {
    cursor: pointer;
    display: block;
}

    .toast {
        background-color: transparent !important;
        border: none !important;
        box-shadow: none !important;
    }

    .toast-body {
        background-color: #198754 !important; /* لون أخضر bootstrap bg-success */
        color: white !important;
        border-radius: 1rem !important;
        padding: 1rem 2rem !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        text-align: center !important;
        gap: 0.75rem;
        min-width: 300px;
    }

</style>


<h4>إضافة منتج </h4>
<div class="container">
    <div class="row">
        <!-- الفورم -->
        <div class="col-lg-6">
            <form asp-action="AddProducts" enctype="multipart/form-data" method="post">
                <input type="hidden" asp-for="ProductId" />

                <div class="form-group">
                    <label>اسم المنتج</label>
                    <input asp-for="ProductName" class="form-control" />
                    <span asp-validation-for="ProductName" class="text-danger"></span>
                </div>

               
                <div class="form-group">
                    <label>التصنيف</label>
                    <select class="form-control" id="categorySelect" name="Category">
                        <option value="">اختر التصنيف</option>
                        @foreach (var cat in Model.ExistingCategories)
                        {
                            <option value="@cat">@cat</option>
                        }
                        <option value="__new__">+ أضف تصنيف جديد</option>
                    </select>
                </div>
                <input type="text" id="newCategoryInput" name="NewCategory" class="form-control mt-2" placeholder="اكتب تصنيف جديد" style="display:none;" />



                <div class="form-group">
                    <label>السعر</label>
                    <input asp-for="Price" class="form-control" />
                    <span asp-validation-for="Price" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label>الوصف</label>
                    <textarea asp-for="Description" class="form-control" rows="4"></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label>صورة المنتج</label>
                    <div class="row justify-content-center">
                        <div class="col-md-6 text-center">
                            <label for="ProductImage" class="upload-label">
                                <div class="upload-area">
                                    <i class="fa fa-cloud-upload fa-3x text-primary"></i>
                                    <p class="mt-2">انقر هنا لتحميل صورة المنتج</p>
                                </div>
                            </label>

                            <input asp-for="ImageUrl" type="file" id="ProductImage" name="NewProduct.ProductImage" accept="image/*" class="upload-input" hidden required />
                            <span asp-validation-for="ImageUrl" class="text-danger"></span>


                            <div class="mt-3">
                                <img id="previewImage" src="#" class="img-preview" />
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">إضافة إلى المكتبة</button>
            </form>
        </div>

        
        <div class="col-lg-6 right-image-container">
            <img id="mainImage" src="@Model.ImageUrl" class="img-fluid" alt="Product Image" />
        </div>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="position-fixed top-50 start-50 translate-middle" style="z-index: 9999;">
        <div id="successToast" class="toast fade show" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-body">
                <i class="fa-solid fa-circle-check fa-lg"></i>
                <span class="fs-5 fw-semibold">تم إضافة المنتج إلى المكتبة</span>
            </div>
        </div>
    </div>

}





@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        // عرض التوست تلقائيًا عند وجوده
            window.onload = function () {
            var toastEl = document.getElementById('successToast');
            if (toastEl) {
                var toast = new bootstrap.Toast(toastEl, { delay: 1000 });
                toast.show();
            }
        };

        // معاينة الصورة
         document.getElementById('ProductImage').addEventListener('change', function (event) {
            var input = event.target;
            var preview = document.getElementById('previewImage');
            var mainImage = document.getElementById('mainImage'); // 👈 صورة اليمين
            if (input.files && input.files[0]) {
                var fileUrl = URL.createObjectURL(input.files[0]);
                preview.src = fileUrl;
                preview.style.display = 'block';
                if (mainImage) {
                    mainImage.src = fileUrl; // ✅ تحديث صورة اليمين مباشرة
                }
            } else {
                preview.src = "#";
                preview.style.display = 'none';
            }
        });

        //التصنيف
               document.addEventListener("DOMContentLoaded", function () {
            var select = document.getElementById("categorySelect");
            var input = document.getElementById("newCategoryInput");

            select.addEventListener("change", function () {
                if (this.value === "__new__") {
                    input.style.display = "block";
                    input.required = true;
                } else {
                    input.style.display = "none";
                    input.value = "";
                    input.required = false;
                }
            });
        });

        
             document.getElementById("categorySelect").addEventListener("change", function () {
            var newCategoryInput = document.getElementById("newCategoryInput");
            if (this.value === "__new__") {
                newCategoryInput.style.display = "block";
            } else {
                newCategoryInput.style.display = "none";
            }
        });

    </script>
}
